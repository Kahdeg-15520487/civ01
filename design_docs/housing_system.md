# Housing System (洞府 - Cave Dwelling)

> "A cultivator's cave is their fortress, their laboratory, and their sanctuary."

## Overview

The housing system allows players to establish and upgrade a personal dwelling that serves multiple functions:
- **Living Space**: Rest, meditation, storage
- **Workshop**: Artifact crafting and refinement
- **Formation Grid**: The cave itself IS a formation
- **Defense**: Protection from enemies and spirit beasts
- **Resource Generation**: Passive Qi and material collection

---

## Core Concept: The Cave as a Circuit

**Philosophy**: Your cave dwelling is not just a building - it's a giant artifact where the walls, floors, and ceilings are the engraving surface.

```
Traditional housing: Walls are walls, circuits are separate
Rune Engraver housing: Walls ARE circuits

The cave structure defines the formation grid.
The formation defines what the cave does.
```

---

## Housing Tiers

### Tier 1: Meditation Cave (打坐洞) - Mortal

```
Size: Single room (5x5m)
Grid: Single-layer, 5x5 per wall
Features:
  - Sleeping mat (respawn point)
  - Basic storage chest (10 slots)
  - Meditation bonus: +10% XP
  - No formations
  - No ambient Qi collection

Build Requirements:
  - Find natural cave OR
  - Rent from sect (100 coins/month)

Upgrades:
  - Excavate expansion (to Tier 2)
  - Install storage runes (storage capacity)
```

---

### Tier 2: Spirit Abode (灵居) - Spirit

```
Size: 3 rooms (15x10m total)
Grid: Dual-layer, 10x10 per wall
Features:
  - Dedicated bedrooms (2)
  - Workshop room (basic crafting)
  - Meditation chamber (+25% XP, +5% regen)
  - Storage formations (50 slots)
  - Ambient Qi collection (1 Qi/min)
  - Basic defense formation (level 10)

Build Requirements:
  - Excavation permit from sect
  - 1000 spirit coins
  - 10 Spirit Stones

Formation Capabilities:
  - Wall engraving (single room)
  - Ambient Qi tapping (local element)
  - Simple automation (lighting, heating)

Rooms:
  - Main Hall (social)
  - Workshop (crafting)
  - Meditation Room (buffs)
```

---

### Tier 3: Earth Palace (地宫) - Earth

```
Size: 10+ rooms, multi-level
Grid: Multi-layer (4), unlimited size
Features:
  - Multiple specialized rooms
  - Advanced workshop (all crafting)
  - Meditation chambers (+50% XP, +15% regen)
  - Storage formations (500 slots, sorting)
  - Ambient Qi collection (10 Qi/min)
  - Qi recycling system (80% efficiency)
  - Advanced defense formation (level 50)
  - Formation nesting (formations within formations)
  - Environmental control (temperature, humidity)

Build Requirements:
  - Land ownership deed
  - 50,000 spirit coins
  - 100 Spirit Stones
  - Sect contribution (1000 contribution points)
  - Earth-tier cultivation level

Formation Capabilities:
  - Multi-room formations
  - External influence (affects surrounding area)
  - Complex automation systems
  - Qi distribution network
  - Formation synthesis (research)

Rooms:
  - Main Hall (grand reception)
  - Workshop (master crafting)
  - Meditation Chamber (multiple types)
  - Library (formation storage)
  - Storage Vault (secure)
  - Alchemy Lab (pills, potions)
  - Spirit Garden (herb growing)
  - Beast Pen (spirit creatures)
  - Training Ground (combat practice)
  - Formation Chamber (core defense)
```

---

### Tier 4: Heaven Domain (天域) - Heaven

```
Size: Pocket dimension (unlimited)
Grid: 3D volumetric, unlimited
Features:
  - Entire pocket dimension
  - Custom physics (gravity, time flow)
  - Reality editing (within limits)
  - Domain expansion (can create sub-domains)
  - Ambient Qi collection (100 Qi/min)
  - Perfect Qi recycling (100% efficiency)
  - Sentient defense formation
  - Inter-domain portals

Build Requirements:
  - Heaven-tier cultivation
  - Comprehend Space Dao
  - 1,000,000 spirit coins
  - Ancient spirit stone (legendary material)
  - Approval from sect elder

Formation Capabilities:
  - World-shaping formations
  - Time acceleration chambers
  - Pocket dimensions within pocket dimensions
  - Reality interface (can edit local constants)
  - Domain battles (can invade others' domains)
```

---

## Room Types & Functions

### Living Rooms

#### Bedroom (寝室)
```
Function: Rest, save point, buff restoration
Size: Small (4x4m)
Engravings:
  - Qi Recovery: +X% stamina regen
  - Dream Protection: Prevent mental attacks during sleep
  - Alarm: Alert system for intruders

Cost: 500 coins (base)
```

#### Meditation Chamber (打坐室)
```
Function: XP gain, cultivation breakthrough
Size: Medium (6x6m)
Engravings:
  - Focus Array: +X% XP
  - Breakthrough Assistance: +Y% chance
  - Element Alignment: Match player's element for bonus

Cost: 2000 coins (base)
Tier: Spirit+
```

---

### Utility Rooms

#### Storage Vault (储藏室)
```
Function: Item storage
Size: Variable (1x1m per 10 slots)
Engravings:
  - Spatial Expansion: More storage per unit area
  - Preservation: Items don't decay
  - Sorting: Auto-sort items
  - Security: Require formation to open

Capacity:
  - Basic: 10 slots/m²
  - With Spatial Runes: 100 slots/m²
  - With Spatial Folding: 1000 slots/m²

Cost: 100 coins per 10 slots (base)
```

#### Library (藏书阁)
```
Function: Store and study formations
Size: Large (10x10m)
Engravings:
  - Formation Storage: Save/load formations
  - Auto-Documentation: Generate formation docs
  - Research Bonus: +X% research speed
  - Sharing: Share formations with allies

Capacity:
  - 100 formations (base)
  - +100 per expansion

Cost: 5000 coins (base)
Tier: Spirit+
```

---

### Production Rooms

#### Workshop (工坊)
```
Function: Craft and refine artifacts
Size: Medium (8x8m)
Engravings:
  - Refining Array: +X% material quality
  - Engraving Table: Access circuit editor
  - Auto-Hammer: Automated crafting (requires recipe)
  - Quality Assurance: +Y% success chance

Stations:
  - Engraving Table (always present)
  - Refining Furnace (addable)
  - Assembly Stand (addable)
  - Testing Chamber (addable)

Cost: 10,000 coins (base)
Tier: Spirit+
```

#### Alchemy Lab (炼丹房)
```
Function: Create pills and potions
Size: Medium (6x6m)
Engravings:
  - Temperature Control: Precise heat management
  - Pressure Regulation: For high-grade pills
  - Elemental Infusion: Add elements to mixtures

Cost: 20,000 coins (base)
Tier: Earth+
```

#### Spirit Garden (灵药园)
```
Function: Grow herbs and reagents
Size: Large (15x15m per plot)
Engravings:
  - Growth Acceleration: -X% grow time
  - Element Matching: Boost specific element herbs
  - Auto-Harvest: Collect when ready
  - Pest Repellent: Prevent qi beasts

Requirements:
  - Must be placed on surface or have light formation
  - Requires Water Qi supply

Cost: 5000 coins per plot (base)
Tier: Spirit+
```

---

### Defense Rooms

#### Formation Chamber (阵法室)
```
Function: Core defense formation controller
Size: Small (4x4m)
Engravings:
  - Defense Matrix: Automatic attack on intruders
  - Alert System: Notify owner of breach
  - Traps: Non-lethal deterrents
  - Lethal Mode: Kill authorized targets

Power:
  - Level × tier multiplier
  - Draws from cave's Qi pool

Cost: 15,000 coins (base)
Tier: Earth+
```

#### Training Ground (演武场)
```
Function: Combat practice, spar with disciples
Size: Large (20x20m)
Engravings:
  - Damage Reduction: Non-lethal sparring
  - Summon Matrix: Spawn training dummies
  - Recording: Review combat performance
  - Tournament Mode: Host friendly duels

Cost: 8000 coins (base)
Tier: Spirit+
```

---

## Ambient Qi System

### Qi Sources by Location

```
Mountain Peak:  High Lightning/Wind, Low Earth
  - Best for: Lightning cultivators, flying artifacts
  - Formation: Lightning rod, wind turbine

River Bank:     High Water, Low Fire
  - Best for: Water cultivators, healing artifacts
  - Formation: Water wheel, purification array

Volcano:        High Fire, Low Water
  - Best for: Fire cultivators, explosive artifacts
  - Formation: Heat absorption, magma tap

Deep Cave:      Stable Earth, No elements
  - Best for: Earth cultivators, defensive formations
  - Formation: Earth reinforcement, stability field

Forest:         High Wood, Balanced others
  - Best for: Wood cultivators, life artifacts
  - Formation: Growth array, bio-dome
```

### Ambient Qi Collection

```
Base Collection: 1 Qi/min per tier of cave
- Mortal: 1 Qi/min (not available)
- Spirit: 10 Qi/min
- Earth: 100 Qi/min
- Heaven: 1000 Qi/min

Formation Multiplier:
- Basic collection: 1x
- Focused array: 2x
- Multi-element tap: 3x
- Vortex formation: 5x
- Heaven's Breath: 10x (Earth-tier+)

Drawbacks:
- Over-tapping: Local Qi depletion (permadeath zone)
- Under-tapping: Qi accumulation (random mutations)
- Element imbalance: Environmental shifts
```

### Environmental Impact

```
Player Action → Formation Effect → Environmental Change

Examples:
- Constant Fire Qi use → Area becomes hot and dry → Plants die
- Constant Water Qi use → Area becomes humid → Mushrooms grow
- Constant Lightning use → Area becomes charged → Attracts lightning beasts
- Earth Qi reinforcement → Ground becomes hard → Mining difficulty +

Long-term consequences:
- Over-exploitation (100 years): Dead zone (no ambient Qi)
- Balanced use: Sustainable (regenerates 1% per year)
- Enhancement: Can enrich area (Earth-tier formations)
```

---

## Formation Grid System

### Wall as Circuit Board

```
Traditional Artifacts:
- Engraving zones are specific areas
- Grid is 2D (mostly)

Cave Dwellings:
- Entire surface is engraveable
- Walls, floor, ceiling all connected
- Multi-layer possible (Earth-tier+)
- 3D formations possible (Heaven-tier)
```

### Grid Tiers

```
Mortal Cave:
- No grid (just natural cave)

Spirit Abode:
- Single layer per surface
- 10x10 grid per meter
- Traces visible (glow lines)

Earth Palace:
- 4 layers per surface
- 50x50 grid per meter
- Traces can be hidden
- Vias between layers

Heaven Domain:
- Unlimited layers
- Volumetric 3D grid
- Spatial folding (non-Euclidean)
- Wireless connections
```

### Room-to-Room Connections

```
Spirit Abode:
- Single room formations
- No room interconnection
- Each room independent

Earth Palace:
- Multi-room formations
- Traces pass through walls
- Centralized control
- Qi distribution network

Heaven Domain:
- Inter-dimensional connections
- Portal formations
- Domain linking
```

---

## Building & Expansion

### Excavation System

```
Method 1: Manual (slow, free)
- Player digs with tools
- 1 m³ per hour
- Can add decorations

Method 2: Formation (fast, costs Qi)
- Auto-digging formation
- 10 m³ per minute
- Requires blueprint
- Costs 10 Qi per m³

Method 3: Hire Contractors (fastest, expensive)
- NPC excavation team
- 100 m³ per hour
- Costs 100 coins per m³
- Requires sect approval
```

### Room Templates

```
Pre-designed rooms:
- Bedrooms (3 sizes)
- Workshops (3 types)
- Storage rooms (4 capacities)
- Defense rooms (2 types)
- Utility rooms (5 types)

Custom rooms:
- Draw shape in editor
- Define dimensions
- Place door connections
- Validate structural integrity
```

### Decoration & Furniture

```
Functional:
- Furniture adds formation slots
- Decorations add ambient buffs
- Masterwork furniture: Unique effects

Examples:
- Meditation Cushion: +5% meditation speed
- Artifact Stand: Display artifacts (bonus to their growth)
- Spirit Lamp: Lighting + passive Qi
- Bookshelf: Formation storage (small)

Custom Furniture:
- Design in artifact editor
- Place as furniture
- Adds functionality
```

---

## Defense & Security

### Formation Defense

```
Automatic Defense:
- Triggers on unauthorized entry
- Power level based on formation
- Lethal or non-lethal modes

Defense Types:
- Kinetic: Physical force (push, crush)
- Elemental: Fire, Lightning, etc.
- Mental: Confusion, fear
- Binding: Immobilization
- Teleport: Eject intruder

Power Sources:
- Ambient Qi (weak)
- Spirit Stones (medium)
- Cultivator Link (strong, drains user)
- Core Formation (strongest, expensive)
```

### Access Control

```
Authorization Levels:
1. Owner (full access)
2. Family/Allies (limited access)
3. Disciples/Servants (restricted access)
4. Guests (public areas only)
5. Intruders (target of defense)

Authentication Methods:
- Spirit Signature (biometric)
- Token/Key (physical item)
- Password (spirit pattern)
- Formation Challenge (puzzle)
```

### Raid System

```
Player vs Player:
- Can raid other players' caves
- Must break defense formation
- Loot: Steal resources, formations
- Risk: Owner alerted, can counter-attack
- Cooldown: 24 hours

NPC Raids:
- Spirit beasts attack (periodic)
- Sect inspections (regulatory)
- Enemy sect attacks (war)
```

---

## Multiplayer & Social

### Co-Op Housing

```
Shared Dwelling:
- Multiple players can live in same cave
- Split costs, share formations
- Requires trust (can steal)

Formations:
- Shared formations pool
- Individual locked storage
- Contribution points system

Breakup:
- Divide formations (player choice)
- Remove shared access
- Each keeps personal items
```

### Visiting

```
Guest System:
- Invite other players to visit
- Show off formations
- Trade formations
- Spar in training ground

Guest Permissions:
- View only (can't interact)
- Limited interaction (can use facilities)
- Full access (dangerous)

Tour Mode:
- Guided tour with highlights
- Formation showcases
- Reviews/ratings
```

### Housing Marketplace

```
Rentals:
- Rent out spare rooms
- Generate passive income
- Guest can't modify formations

Sales:
- Sell entire cave
- Transfer all formations
- Requires trust/contract

Formation Leasing:
- Lease formation use
- Time-limited access
- Auto-revoke after period
```

---

## Open Questions

- [ ] How does cave location affect gameplay?
- [ ] Should caves be destructible by other players?
- [ ] Furniture wear and repair?
- [ ] NPC servants/disciples management?
- [ ] Cave reputation system?
- [ ] Cross-server housing (phasing)?
